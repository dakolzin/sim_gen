# sim_gen ‚Äî —Å–∏–º—É–ª—è—Ü–∏—è –∑–∞—Ö–≤–∞—Ç–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä–æ–º panda –≤ MuJoCo



*MuJoCo‚Äëpowered grasp‚Äëpipeline: –∫–∞–º–µ—Ä–∞ ‚Üí –æ–±–ª–∞–∫–æ ‚Üí SBG ‚Üí CV‚Äëgrasp ‚Üí IK Panda ‚Üí –∑–∞—Ö–≤–∞—Ç –∏ –ø–æ–¥—ä—ë–º.*

![sim](media/sim.png)

---

## 1¬†¬∑¬†–ß—Ç–æ¬†—ç—Ç–æ

–í —ç—Ç–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –∑–∞—Ö–≤–∞—Ç–∞ –¥–µ—Ç–∞–ª–∏ –≤ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º –¥–≤–∏–∂–∫–µ **MuJoCo¬†3.x**:

- –°–∫—Ä–∏–ø—Ç `run_grasp.py` —Å—á–∏—Ç—ã–≤–∞–µ—Ç RGB‚ÄëD –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —Å—Ç—Ä–æ–∏—Ç —Ü–≤–µ—Ç–Ω–æ–µ –æ–±–ª–∞–∫–æ —Ç–æ—á–µ–∫ (Open3D) –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Ç–æ–∫ RGB (OpenCV).
- –û–±–ª–∞–∫–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ SBG‚Äë—Å–µ—Ä–≤–µ—Ä —Å CV‚Äë–º–æ–¥–µ–ª—å—é –∑–∞—Ö–≤–∞—Ç–æ–≤.
- –õ—É—á—à–∏–π grasp –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –∏–∑ —Å–∏—Å—Ç–µ–º—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∫–∞–º–µ—Ä—ã –≤ —Å–∏—Å—Ç–µ–º—É —Ä–æ–±–æ—Ç–∞, –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è —á–µ—Ä–µ–∑ IK Panda.
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –æ—à–∏–±–∫–∏, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ü–µ–Ω–∞—Ä–∏–π: –æ—Ç–∫—Ä—ã—Ç—å ‚Üí –ø–æ–¥—ä–µ—Ö–∞—Ç—å ‚Üí –∑–∞–∫—Ä—ã—Ç—å –¥–æ –ø–æ—Ä–æ–≥–∞ —Å–∏–ª—ã ‚Üí –ø–∞—É–∑–∞ ‚Üí –ø–æ–¥—ä—ë–º –¥–µ—Ç–∞–ª–∏ ‚Üí —Ä–∞–∑–∂–∞—Ç—å.
- –°—Ü–µ–Ω–∞ –æ–ø–∏—Å–∞–Ω–∞ –≤ `scene/` (MJCF + 3D‚Äë–º–æ–¥–µ–ª–∏ –≤ `scene/assets/`).
- –ö–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã –ª–µ–∂–∞—Ç –≤ `calib/`.

---

## 2¬†¬∑¬†–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- **Python¬†‚â•¬†3.9**
- **MuJoCo¬†‚â•¬†3.1** ‚Äî `pip install mujoco`
- **Open3D**, **OpenCV**, **NumPy**, **spatialmath**
- **msgpack**, **msgpack‚Äënumpy** (–¥–ª—è –∫–ª–∏–µ–Ω—Ç‚Äë—Å–µ—Ä–≤–µ—Ä–∞ –æ–±–º–µ–Ω–∞)
- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) **Git¬†LFS** ‚Äî –µ—Å–ª–∏ —Ö—Ä–∞–Ω–∏—Ç–µ —Ç—è–∂—ë–ª—ã–µ –∞—Å—Å–µ—Ç—ã –≤ `scene/assets/`

–í—Å–µ –ø–∞–∫–µ—Ç—ã –≤ `requirements.txt` –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:

```bash
pip install -r requirements.txt
```

---

## 3¬†¬∑¬†–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/<–≤–∞—à_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å>/sim_d435.git
cd sim_d435

# –°–æ–∑–¥–∞—ë–º –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv env && source env/bin/activate

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞–π–ø–ª–∞–π–Ω –∑–∞—Ö–≤–∞—Ç–∞
python run_grasp.py
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–∫—Ä–æ—é—Ç—Å—è –æ–∫–Ω–∞ `RGB` –∏ `Cloud`; –ø—Ä–∏ —É–¥–∞—á–Ω–æ–º –∑–∞—Ö–≤–∞—Ç–µ –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä –ø–æ–¥–Ω–∏–º–µ—Ç –¥–µ—Ç–∞–ª—å.

---

## 4¬†¬∑¬†–°—Ç—Ä—É–∫—Ç—É—Ä–∞

```plaintext
.
‚îú‚îÄ‚îÄ calib/                  # —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ last_calib.npz
‚îú‚îÄ‚îÄ scene/                  # MJCF‚Äë—Å—Ü–µ–Ω–∞ –∏ –∞—Å—Å–µ—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ assets/             # .obj/.stl –º–æ–¥–µ–ª–∏ –æ–±—ä–µ–∫—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ camera_d435.xml
‚îÇ   ‚îú‚îÄ‚îÄ panda.xml
‚îÇ   ‚îî‚îÄ‚îÄ scene.xml
‚îú‚îÄ‚îÄ simlib/                 # –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏: config, transforms, IK, gripper‚Ä¶
‚îÇ   ‚îú‚îÄ‚îÄ config.py
‚îÇ   ‚îú‚îÄ‚îÄ gripper.py
‚îÇ   ‚îú‚îÄ‚îÄ ik_driver.py
‚îÇ   ‚îú‚îÄ‚îÄ mujoco_io.py
‚îÇ   ‚îú‚îÄ‚îÄ mujoco_render.py
‚îÇ   ‚îú‚îÄ‚îÄ sbg_client.py
‚îÇ   ‚îú‚îÄ‚îÄ tcp_eval.py
‚îÇ   ‚îú‚îÄ‚îÄ transforms.py
‚îÇ   ‚îî‚îÄ‚îÄ ‚Ä¶
‚îú‚îÄ‚îÄ run_grasp.py            # –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –ø–∞–π–ø–ª–∞–π–Ω–∞ –∑–∞—Ö–≤–∞—Ç–∞
‚îî‚îÄ‚îÄ README.md
```

---

## 5¬†¬∑¬†–ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (`simlib/config.py`)

| –ü–∞—Ä–∞–º–µ—Ç—Ä          | –ü–æ¬†—É–º–æ–ª—á–∞–Ω–∏—é        | –û–ø–∏—Å–∞–Ω–∏–µ                                      |
| ----------------- | ------------------- | --------------------------------------------- |
| `XML`             | `"scene/scene.xml"` | –ü—É—Ç—å –∫ MJCF‚Äë—Å—Ü–µ–Ω–µ                             |
| `WIDTH, HEIGHT`   | `640, 480`          | –†–∞–∑–º–µ—Ä—ã off‚Äëscreen —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –æ–±–ª–∞–∫–∞          |
| `SETTLE_SEC`      | `1.0`               | –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è —Å—Ü–µ–Ω—ã (—Å–µ–∫)                    |
| `SLEEP_BETWEEN`   | `0.5`               | –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏ —Ü–∏–∫–ª–∞ (—Å–µ–∫)            |
| `GRIPPER_OPEN_M`  | `0.08`              | –ú–∞–∫—Å. —à–∏—Ä–∏–Ω–∞ –ó–£ (–º)                   |
| `GRIPPER_CLOSE_M` | `0.00`              | –ú–∏–Ω. —à–∏—Ä–∏–Ω–∞ –ó–£ (–º)                    |
| `F_THRESH`        | `150.0`             | –ü–æ—Ä–æ–≥ —Å–∏–ª—ã –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è (N)         |
| `DO_IK`           | `True`              | –í–∫–ª—é—á–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ IK                    |
| `USE_TCP_TIP`     | `False`             | –£—á–µ—Å—Ç—å —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç TCP –¥–æ –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏ –ó–£ |

–ò–∑–º–µ–Ω—è–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä—è–º–æ –≤ `simlib/config.py` –∏–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

---

## 6¬†¬∑¬†–ü–æ–≤—Ç–æ—Ä–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
python -m venv env
source env/bin/activate
pip install -r requirements.txt
```

---

---

## 7¬†¬∑¬†–ó–∞–ø—É—Å–∫

–ó–∞–ø—É—Å–∫ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ SBG:
```bash
bash sim_go.sh
```
–ó–∞–ø—É—Å–∫ —Å–∏–º—É–ª—è—Ü–∏–∏:
```bash
python run_grasp.py 
```
–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Å–∏–º—É–ª—è—Ü–∏—é –∑–∞–∫—Ä—ã—Ç—å –æ–∫–æ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞—Ö–≤–∞—Ç–∞ –≤ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–µ.

![inf](media/inf.png)

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä –ø–µ—Ä–µ–π–¥–µ—Ç –≤ —ç—Ç—É —Ç–æ—á–∫—É.

![go](media/go.png)
---

## 7¬†¬∑¬†To¬†Do

- üéÆ –î–æ–±–∞–≤–∏—Ç—å CLI‚Äë–∞—Ä–≥—É–º–µ–Ω—Ç—ã –≤–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–∞
- üñºÔ∏è –†–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è –ø–æ–∑ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤
- üì¶ Dockerfile + CI –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–±–æ—Ä–æ–∫

